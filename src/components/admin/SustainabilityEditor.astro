---
interface Sustainability {
  carbonOffset?: string;
  communityImpact?: string;
  supportVehicle?: boolean;
}

interface Props {
  data?: Sustainability;
}

const { data = {} } = Astro.props;
const uniqueId = `sustainability-editor-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="sustainability-editor-container" id={`${uniqueId}-container`}>
  <label class="block text-sm font-medium text-gray-700 mb-4">
    Sustainability & Impact
    <span class="text-gray-500 font-normal">(Optional)</span>
  </label>

  <div class="space-y-4">
    <div>
      <label class="block text-xs font-medium text-gray-500 mb-1">Carbon Offset Initiative</label>
      <textarea
        rows="3"
        placeholder="Describe carbon offset measures..."
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
        data-field="carbonOffset">{data.carbonOffset || ''}</textarea
      >
    </div>

    <div>
      <label class="block text-xs font-medium text-gray-500 mb-1">Community Impact</label>
      <textarea
        rows="3"
        placeholder="Describe local community benefits..."
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
        data-field="communityImpact">{data.communityImpact || ''}</textarea
      >
    </div>

    <div class="flex items-center">
      <input
        type="checkbox"
        id={`${uniqueId}-supportVehicle`}
        class="w-4 h-4 text-emerald-600 border-gray-300 rounded focus:ring-emerald-500"
        data-field="supportVehicle"
        checked={data.supportVehicle === true}
      />
      <label for={`${uniqueId}-supportVehicle`} class="ml-2 text-sm text-gray-700">
        Support Vehicle Available
      </label>
    </div>
  </div>

  <!-- Hidden input for form submission -->
  <input type="hidden" name="sustainability-json" id={`${uniqueId}-json`} value="" />
</div>

<script define:vars={{ uniqueId }}>
  // Register serializer
  if (typeof window !== 'undefined') {
    if (!window.sustainabilityEditorSerializers) {
      window.sustainabilityEditorSerializers = {};
    }

    window.sustainabilityEditorSerializers['sustainability'] = function () {
      const container = document.getElementById(`${uniqueId}-container`);
      if (!container) return null;

      const carbonOffset = container.querySelector('[data-field="carbonOffset"]').value.trim();
      const communityImpact = container
        .querySelector('[data-field="communityImpact"]')
        .value.trim();
      const supportVehicle = container.querySelector('[data-field="supportVehicle"]').checked;

      // Only return object if at least one field has data
      if (carbonOffset || communityImpact || supportVehicle) {
        return {
          carbonOffset: carbonOffset || undefined,
          communityImpact: communityImpact || undefined,
          supportVehicle,
        };
      }

      return null;
    };
  }
</script>
