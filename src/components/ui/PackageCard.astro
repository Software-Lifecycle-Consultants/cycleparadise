---
import type { TourPackage } from '../../types/models';

export interface Props {
  package: TourPackage;
  featured?: boolean;
  className?: string;
}

const { package: tourPackage, featured = false, className = '' } = Astro.props;

// Helper function to get difficulty color
function getDifficultyColor(level: string): string {
  switch (level) {
    case 'BEGINNER':
      return 'bg-green-100 text-green-800';
    case 'INTERMEDIATE':
      return 'bg-yellow-100 text-yellow-800';
    case 'ADVANCED':
      return 'bg-orange-100 text-orange-800';
    case 'EXPERT':
      return 'bg-red-100 text-red-800';
    default:
      return 'bg-gray-100 text-gray-800';
  }
}

// Helper function to get difficulty label
function getDifficultyLabel(level: string): string {
  return level.charAt(0).toUpperCase() + level.slice(1).toLowerCase();
}

// Get first image from gallery or use placeholder
const firstImage =
  // tourPackage.mediaGallery?.images?.[0]?.url ||
  // '/images/package-placeholder.jpg' ||
  'https://plus.unsplash.com/premium_photo-1730145749791-28fc538d7203?q=80&w=1035&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; // TODO: remove placeholder image
const packageUrl = `/packages/${tourPackage.slug}`;
---

<div
  class={`group bg-white rounded-2xl overflow-hidden hover:shadow-xl transition-all duration-300 ${className}`}
>
  <!-- Image Section -->
  <div class="relative overflow-hidden">
    <a href={packageUrl}>
      <img
        src={firstImage}
        alt={tourPackage.title}
        class="w-full h-56 object-cover group-hover:scale-105 transition-transform duration-500"
        loading="lazy"
      />
    </a>

    <!-- Price Badge - Top Left -->
    <div class="absolute top-4 left-4">
      <div class="bg-white/95 backdrop-blur-sm rounded-full px-4 py-2 shadow-lg">
        <span class="text-lg font-bold text-gray-900">${tourPackage.basePrice}</span>
        <span class="text-xs text-gray-600 ml-1">/ person</span>
      </div>
    </div>
  </div>

  <!-- Content Section -->
  <div class="p-6">
    <!-- Difficulty and Duration Row -->
    <div class="flex items-center justify-between mb-3">
      <span
        class={`px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide ${getDifficultyColor(tourPackage.difficultyLevel)}`}
      >
        {getDifficultyLabel(tourPackage.difficultyLevel)}
      </span>
      <div class="flex items-center text-sm text-gray-500">
        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>{tourPackage.duration} {tourPackage.duration === 1 ? 'Day' : 'Days'}</span>
      </div>
    </div>

    <!-- Title -->
    <h3 class="font-bold text-xl text-gray-900 mb-2 line-clamp-2 min-h-[3.5rem]">
      <a href={packageUrl} class="hover:text-primary-600 transition-colors">
        {tourPackage.title}
      </a>
    </h3>

    <!-- Short Description -->
    {
      tourPackage.shortDescription && (
        <p class="text-sm text-gray-600 mb-4 line-clamp-2 leading-relaxed">
          {tourPackage.shortDescription}
        </p>
      )
    }

    <!-- Region and Route Info -->
    <div class="flex items-start text-xs text-gray-500 mb-4">
      <svg
        class="w-3.5 h-3.5 mr-1.5 mt-0.5 flex-shrink-0"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
        ></path>
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
      </svg>
      <span class="line-clamp-1">Route: {tourPackage.region}</span>
    </div>

    <!-- View Details Button -->
    <a
      href={packageUrl}
      class="block w-full text-center bg-white border-2 border-primary-600 text-primary-600 px-4 py-2.5 rounded-full font-semibold text-sm hover:bg-primary-600 hover:text-white transition-all duration-300"
    >
      View Details
    </a>
  </div>
</div>

<style>
  /* Line clamp utility for text truncation */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .aspect-w-16 {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
  }

  .aspect-w-16 > * {
    position: absolute;
    height: 100%;
    width: 100%;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
</style>
