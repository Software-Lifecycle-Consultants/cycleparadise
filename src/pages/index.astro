---
import Layout from '../layouts/Layout.astro';
import PackageCard from '../components/ui/PackageCard.astro';
import YouTubeEmbed from '../components/media/YouTubeEmbed.astro';
import InstagramFeed from '../components/media/InstagramFeed.astro';
import { tourPackageRepository } from '../lib/db/repositories/tour-packages.js';
import { fallbackTourPackages } from '../data/fallback-tour-packages.ts';
import type { TourPackage } from '../types/models.js';

const databaseUrl = typeof process !== 'undefined' ? process.env?.DATABASE_URL : undefined;
const hasDatabaseConnection = Boolean(databaseUrl);

const getFeaturedFallbackPackages = (): TourPackage[] => {
  const fallbackList = fallbackTourPackages as TourPackage[];
  const featured = fallbackList.filter((pkg) => pkg.featured);
  return (featured.length > 0 ? featured : fallbackList).slice(0, 3);
};

// Fetch featured packages for homepage
let featuredPackages: TourPackage[] = [];
if (hasDatabaseConnection) {
  try {
    featuredPackages = await tourPackageRepository.findFeatured(3);
  } catch (error) {
    console.error('Failed to load featured packages:', error);
    featuredPackages = getFeaturedFallbackPackages();
  }
} else {
  featuredPackages = getFeaturedFallbackPackages();
}
---

<Layout
  title="Cycle Paradise - Sri Lanka Cycling Tours"
  description="Experience the breathtaking beauty of Sri Lanka on premium cycling tours. Discover scenic routes, cultural treasures, and unforgettable adventures."
>
  <!-- Hero Section -->
  <section class="relative min-h-screen flex items-center -mt-[72px]">
    <!-- Background Image with Overlay -->
    <div class="absolute inset-0 z-0">
      <img
        src="https://images.unsplash.com/photo-1541625602330-2277a4c46182?q=80&w=2070&auto=format&fit=crop"
        alt="Cyclist riding through scenic Sri Lankan landscape"
        class="w-full h-full object-cover"
      />
      <!-- Dark overlay for better text contrast -->
      <div class="absolute inset-0 bg-gradient-to-r from-black/70 via-black/50 to-black/30"></div>
    </div>

    <!-- Hero Content -->
    <div class="relative z-10 mx-auto max-w-7xl px-8 sm:px-12 lg:px-20 w-full pt-32">
      <div class="max-w-3xl">
        <h1
          class="reveal reveal-delay-1 font-display font-bold text-4xl tracking-tight text-white sm:text-7xl leading-tight"
        >
          Discover Sri Lanka<br />on
          <span class="text-primary-500">Two Wheels</span>
        </h1>
        <p class="reveal reveal-delay-2 mt-6 text-lg leading-8 text-gray-100 max-w-2xl">
          Experience the breathtaking beauty of the Pearl of the Indian Ocean through our carefully
          crafted cycling tours. From mountain trails to coastal routes, adventure awaits at every
          turn.
        </p>
        <div
          class="reveal reveal-delay-3 mt-10 flex flex-col sm:flex-row items-center gap-y-4 sm:gap-y-0 sm:gap-x-6"
        >
          <a
            href="/packages"
            class="w-full sm:w-auto text-center rounded-full bg-primary-600 px-8 py-4 text-lg font-semibold text-white shadow-lg hover:bg-primary-700 hover:shadow-xl focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 transition-all"
          >
            Explore Packages
          </a>
          <a
            href="/guides"
            class="w-full sm:w-auto text-center glassy-btn text-lg font-semibold leading-6 text-white transition-all"
          >
            Cycling Guides <span aria-hidden="true">→</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="py-24 bg-white">
    <div class="mx-auto max-w-7xl px-8 sm:px-12 lg:px-20">
      <div class="reveal text-center mb-20">
        <p class="text-xs font-semibold tracking-widest text-gray-500 uppercase mb-4">
          Why Choose Cycle Paradise
        </p>
        <h2 class="font-display font-semibold text-2xl text-gray-900 sm:text-4xl mb-6">
          We Make The Journey<br />Safe & Unforgettable
        </h2>
        <p class="mt-4 text-sm text-gray-600 max-w-2xl mx-auto leading-relaxed">
          From misty mountain trails to coastal breezes—we know every curve, climb, and hidden gem
          that makes Sri Lanka's cycling routes extraordinary.
        </p>
      </div>

      <div class="grid grid-cols-1 gap-12 md:gap-8 sm:grid-cols-2 lg:grid-cols-3 max-w-5xl mx-auto">
        <!-- Feature 1 - Scenic Routes -->
        <div class="reveal reveal-delay-1 text-center px-8 sm:px-4 lg:px-6">
          <div
            class="mx-auto w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mb-6"
          >
            <svg
              class="w-9 h-9 text-emerald-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </div>
          <h3 class="font-semibold text-lg text-gray-900 mb-3">Scenic Routes</h3>
          <p class="text-sm text-gray-600 leading-relaxed">
            Carefully selected paths through Sri Lanka's most beautiful landscapes, from tea
            plantations to pristine beaches.
          </p>
        </div>

        <!-- Feature 2 - Safe & Secure -->
        <div class="reveal reveal-delay-2 text-center px-8 sm:px-4 lg:px-6">
          <div
            class="mx-auto w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mb-6"
          >
            <svg
              class="w-9 h-9 text-blue-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              ></path>
            </svg>
          </div>
          <h3 class="font-semibold text-lg text-gray-900 mb-3">Safe & Secure</h3>
          <p class="text-sm text-gray-600 leading-relaxed">
            Professional guides, quality equipment, and comprehensive safety measures for a
            worry-free experience.
          </p>
        </div>

        <!-- Feature 3 - Cultural Immersion -->
        <div class="reveal reveal-delay-3 text-center px-8 sm:px-4 lg:px-6">
          <div
            class="mx-auto w-20 h-20 bg-cyan-100 rounded-full flex items-center justify-center mb-6"
          >
            <svg
              class="w-9 h-9 text-cyan-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
              ></path>
            </svg>
          </div>
          <h3 class="font-semibold text-lg text-gray-900 mb-3">Cultural Immersion</h3>
          <p class="text-sm text-gray-600 leading-relaxed">
            Connect with local communities, taste authentic cuisine, and discover Sri Lanka's rich
            heritage.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Packages Preview -->
  <section class="py-24 bg-gray-50">
    <div class="mx-auto max-w-7xl px-8 sm:px-12 lg:px-20">
      <div class="reveal flex flex-col sm:flex-row sm:items-end sm:justify-between mb-12">
        <div>
          <h2 class="font-display font-semibold text-3xl text-gray-900 sm:text-4xl mb-3">
            Popular Adventures
          </h2>
          <p class="text-sm text-gray-600">
            Select from our most loved cycling routes. Custom tours available upon request.
          </p>
        </div>
        <a
          href="/packages"
          class="hidden sm:inline-flex mt-4 sm:mt-0 items-center text-sm font-semibold text-primary-600 hover:text-primary-700 transition-colors group"
        >
          View All Packages
          <svg
            class="ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>

      <!-- Featured packages using PackageCard component -->
      <div class="reveal reveal-delay-1 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
        {featuredPackages.map((tourPackage) => <PackageCard package={tourPackage} />)}
      </div>

      <!-- Mobile View All Link -->
      <div class="mt-8 text-center sm:hidden">
        <a
          href="/packages"
          class="inline-flex items-center text-sm font-semibold text-primary-600 hover:text-primary-700 transition-colors group"
        >
          View All Packages
          <svg
            class="ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Video Section -->
  <section class="py-24 bg-white">
    <div class="mx-auto max-w-7xl px-8 sm:px-12 lg:px-20">
      <div class="text-center mb-16">
        <h2 class="font-display font-semibold text-3xl text-gray-900 sm:text-4xl">
          Experience Sri Lanka Like Never Before
        </h2>
        <p class="mt-4 text-lg text-gray-600">
          Watch our riders explore the incredible landscapes and vibrant culture of Sri Lanka.
        </p>
      </div>

      <!-- Video embed -->
      <div class="max-w-4xl mx-auto">
        <YouTubeEmbed
          videoId="dQw4w9WgXcQ"
          title="Cycle Paradise - Sri Lanka Adventure Highlights"
          className="rounded-xl shadow-2xl"
        />
      </div>
    </div>
  </section>

  <!-- Instagram Feed Section -->
  <section class="py-24 bg-gray-50">
    <div class="mx-auto max-w-7xl px-8 sm:px-12 lg:px-20">
      <InstagramFeed hashtag="cycleparadise" limit={6} title="Follow Our Adventures" />
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-primary-600">
    <div class="mx-auto max-w-7xl px-8 py-16 sm:px-12 lg:px-20">
      <div class="text-center">
        <h2 class="font-display font-semibold text-3xl text-white sm:text-4xl">
          Ready for Your Sri Lankan Adventure?
        </h2>
        <p class="mt-4 text-xl text-primary-100">
          Join thousands of cyclists who have discovered the magic of Sri Lanka with us.
        </p>
        <div class="mt-8">
          <a
            href="/packages"
            class="inline-flex items-center px-8 py-3 border border-transparent text-lg font-medium rounded-full text-primary-600 bg-white hover:bg-gray-50 transition-colors"
          >
            Start Your Journey
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Reveal Animation Keyframes */
  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Initial state for elements waiting to be revealed */
  .reveal {
    opacity: 0;
    transform: translateY(30px);
  }

  /* Active state when element enters viewport */
  .reveal-active {
    animation: fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  /* Staggered delays for sequential reveals */
  .reveal-delay-1 {
    animation-delay: 0.1s;
  }
  .reveal-delay-2 {
    animation-delay: 0.2s;
  }
  .reveal-delay-3 {
    animation-delay: 0.3s;
  }
  .reveal-delay-4 {
    animation-delay: 0.4s;
  }
  .reveal-delay-5 {
    animation-delay: 0.5s;
  }
  .reveal-delay-6 {
    animation-delay: 0.6s;
  }

  /* Glassy Button Styling */
  .glassy-btn {
    padding: 1rem 2rem;
    border-radius: 9999px;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
  }

  .glassy-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.15);
  }
</style>

<script>
  // Intersection Observer for performant scroll-triggered animations
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('reveal-active');
            // Unobserve after animation to free resources
            observer.unobserve(entry.target);
          }
        });
      },
      {
        rootMargin: '0px 0px -50px 0px', // Trigger slightly before element is visible
        threshold: 0.1,
      }
    );

    // Observe all elements with reveal class
    document.querySelectorAll('.reveal').forEach((el) => {
      observer.observe(el);
    });
  } else {
    // Fallback for browsers without IntersectionObserver support
    document.querySelectorAll('.reveal').forEach((el) => {
      el.classList.add('reveal-active');
    });
  }
</script>
