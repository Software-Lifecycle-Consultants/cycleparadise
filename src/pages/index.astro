---
import Layout from '../layouts/Layout.astro';
import PackageCard from '../components/ui/PackageCard.astro';
import YouTubeEmbed from '../components/media/YouTubeEmbed.astro';
import InstagramFeed from '../components/media/InstagramFeed.astro';
import { tourPackageRepository } from '../lib/db/repositories/tour-packages.js';
import { fallbackTourPackages } from '../data/fallback-tour-packages.ts';
import type { TourPackage } from '../types/models.js';

const databaseUrl = typeof process !== 'undefined' ? process.env?.DATABASE_URL : undefined;
const hasDatabaseConnection = Boolean(databaseUrl);

const getFeaturedFallbackPackages = (): TourPackage[] => {
  const fallbackList = fallbackTourPackages as TourPackage[];
  const featured = fallbackList.filter((pkg) => pkg.featured);
  return (featured.length > 0 ? featured : fallbackList).slice(0, 3);
};

// Fetch featured packages for homepage
let featuredPackages: TourPackage[] = [];
if (hasDatabaseConnection) {
  try {
    featuredPackages = await tourPackageRepository.findFeatured(3);
  } catch (error) {
    console.error('Failed to load featured packages:', error);
    featuredPackages = getFeaturedFallbackPackages();
  }
} else {
  featuredPackages = getFeaturedFallbackPackages();
}
---

<Layout
  title="Cycle Paradise - Sri Lanka Cycling Tours"
  description="Experience the breathtaking beauty of Sri Lanka on premium cycling tours. Discover scenic routes, cultural treasures, and unforgettable adventures."
>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-b from-primary-50 to-white">
    <div class="mx-auto max-w-7xl px-4 py-24 sm:px-6 lg:px-8">
      <div class="text-center">
        <h1
          class="reveal reveal-delay-1 font-display font-bold text-4xl tracking-tight text-gray-900 sm:text-6xl"
        >
          Discover Sri Lanka on
          <span class="text-primary-600">Two Wheels</span>
        </h1>
        <p class="reveal reveal-delay-2 mx-auto mt-6 max-w-2xl text-lg leading-8 text-gray-600">
          Experience the breathtaking beauty of the Pearl of the Indian Ocean through our carefully
          crafted cycling tours. From mountain trails to coastal routes, adventure awaits at every
          turn.
        </p>
        <div class="reveal reveal-delay-3 mt-10 flex items-center justify-center gap-x-6">
          <a
            href="/packages"
            class="rounded-full bg-primary-600 px-6 py-3 text-lg font-semibold text-white shadow-sm hover:bg-primary-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 transition-colors"
          >
            View Tour Packages
          </a>
          <a
            href="/guides"
            class="text-lg font-semibold leading-6 text-gray-900 hover:text-primary-600 transition-colors"
          >
            Cycling Guides <span aria-hidden="true">â†’</span>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="py-24 bg-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="reveal text-center mb-16">
        <h2 class="font-display font-bold text-3xl text-gray-900 sm:text-4xl">
          Why Choose Cycle Paradise?
        </h2>
        <p class="mt-4 text-lg text-gray-600">
          We make your cycling adventure in Sri Lanka safe, comfortable, and unforgettable.
        </p>
      </div>

      <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
        <!-- Feature 1 -->
        <div class="reveal reveal-delay-1 text-center">
          <div
            class="mx-auto w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mb-6"
          >
            <svg
              class="w-8 h-8 text-primary-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </div>
          <h3 class="font-semibold text-xl text-gray-900 mb-2">Scenic Routes</h3>
          <p class="text-gray-600">
            Carefully selected paths through Sri Lanka's most beautiful landscapes, from tea
            plantations to pristine beaches.
          </p>
        </div>

        <!-- Feature 2 -->
        <div class="reveal reveal-delay-2 text-center">
          <div
            class="mx-auto w-16 h-16 bg-tropical-blue/10 rounded-full flex items-center justify-center mb-6"
          >
            <svg
              class="w-8 h-8 text-tropical-blue"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              ></path>
            </svg>
          </div>
          <h3 class="font-semibold text-xl text-gray-900 mb-2">Safe & Secure</h3>
          <p class="text-gray-600">
            Professional guides, quality equipment, and comprehensive safety measures for a
            worry-free experience.
          </p>
        </div>

        <!-- Feature 3 -->
        <div class="reveal reveal-delay-3 text-center">
          <div
            class="mx-auto w-16 h-16 bg-tropical-green/10 rounded-full flex items-center justify-center mb-6"
          >
            <svg
              class="w-8 h-8 text-tropical-green"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
              ></path>
            </svg>
          </div>
          <h3 class="font-semibold text-xl text-gray-900 mb-2">Cultural Immersion</h3>
          <p class="text-gray-600">
            Connect with local communities, taste authentic cuisine, and discover Sri Lanka's rich
            heritage.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Packages Preview -->
  <section class="py-24 bg-gray-50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="reveal text-center mb-16">
        <h2 class="font-display font-bold text-3xl text-gray-900 sm:text-4xl">
          Featured Tour Packages
        </h2>
        <p class="mt-4 text-lg text-gray-600">
          Handpicked adventures showcasing the best of Sri Lankan cycling.
        </p>
      </div>

      <!-- Featured packages using PackageCard component -->
      <div class="reveal reveal-delay-1 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
        {featuredPackages.map((tourPackage) => <PackageCard package={tourPackage} />)}
      </div>

      <div class="text-center mt-12">
        <a
          href="/packages"
          class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-full text-primary-700 bg-primary-100 hover:bg-primary-200 transition-colors"
        >
          View All Packages
          <svg class="ml-2 -mr-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Video Section -->
  <section class="py-24 bg-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="font-display font-bold text-3xl text-gray-900 sm:text-4xl">
          Experience Sri Lanka Like Never Before
        </h2>
        <p class="mt-4 text-lg text-gray-600">
          Watch our riders explore the incredible landscapes and vibrant culture of Sri Lanka.
        </p>
      </div>

      <!-- Video embed -->
      <div class="max-w-4xl mx-auto">
        <YouTubeEmbed
          videoId="dQw4w9WgXcQ"
          title="Cycle Paradise - Sri Lanka Adventure Highlights"
          className="rounded-xl shadow-2xl"
        />
      </div>
    </div>
  </section>

  <!-- Instagram Feed Section -->
  <section class="py-24 bg-gray-50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <InstagramFeed hashtag="cycleparadise" limit={6} title="Follow Our Adventures" />
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-primary-600">
    <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8">
      <div class="text-center">
        <h2 class="font-display font-bold text-3xl text-white sm:text-4xl">
          Ready for Your Sri Lankan Adventure?
        </h2>
        <p class="mt-4 text-xl text-primary-100">
          Join thousands of cyclists who have discovered the magic of Sri Lanka with us.
        </p>
        <div class="mt-8">
          <a
            href="/packages"
            class="inline-flex items-center px-8 py-3 border border-transparent text-lg font-medium rounded-full text-primary-600 bg-white hover:bg-gray-50 transition-colors"
          >
            Start Your Journey
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Reveal Animation Keyframes */
  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Initial state for elements waiting to be revealed */
  .reveal {
    opacity: 0;
    transform: translateY(30px);
  }

  /* Active state when element enters viewport */
  .reveal-active {
    animation: fadeUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  /* Staggered delays for sequential reveals */
  .reveal-delay-1 {
    animation-delay: 0.1s;
  }
  .reveal-delay-2 {
    animation-delay: 0.2s;
  }
  .reveal-delay-3 {
    animation-delay: 0.3s;
  }
  .reveal-delay-4 {
    animation-delay: 0.4s;
  }
  .reveal-delay-5 {
    animation-delay: 0.5s;
  }
  .reveal-delay-6 {
    animation-delay: 0.6s;
  }
</style>

<script>
  // Intersection Observer for performant scroll-triggered animations
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('reveal-active');
            // Unobserve after animation to free resources
            observer.unobserve(entry.target);
          }
        });
      },
      {
        rootMargin: '0px 0px -50px 0px', // Trigger slightly before element is visible
        threshold: 0.1,
      }
    );

    // Observe all elements with reveal class
    document.querySelectorAll('.reveal').forEach((el) => {
      observer.observe(el);
    });
  } else {
    // Fallback for browsers without IntersectionObserver support
    document.querySelectorAll('.reveal').forEach((el) => {
      el.classList.add('reveal-active');
    });
  }
</script>
