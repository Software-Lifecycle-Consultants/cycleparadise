---
import UserForm from '../../../../components/admin/UserForm.astro';
import AdminLayout from '../../../../layouts/AdminLayout.astro';
import { prisma } from '../../../../lib/db/connection';

const { id } = Astro.params;
const user = Astro.locals.user;
if (!user) {
  return Astro.redirect('/admin/login');
}

if (!id) {
  return Astro.redirect('/admin/users');
}

let userData = null;
try {
  userData = await prisma.adminUser.findUnique({
    where: { id },
    select: {
      id: true,
      email: true,
      firstName: true,
      lastName: true,
      role: true,
      isActive: true,
    }
  });

  if (!userData) {
    return Astro.redirect('/admin/users');
  }
} catch (error) {
  console.error('Error fetching user:', error);
  return Astro.redirect('/admin/users');
}
---

<AdminLayout title="Edit User" user={user}>
  <div class="max-w-3xl mx-auto">
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900">Edit User</h1>
      <p class="text-gray-600 mt-1">Update user account information</p>
    </div>

    <UserForm user={userData} isEdit={true} />
  </div>
</AdminLayout>
